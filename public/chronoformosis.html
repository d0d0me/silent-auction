<script>
  const form = document.getElementById('bid-form');
  const message = document.getElementById('form-message');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(form));

    try {
      const res = await fetch('/api/bids', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      });

      const result = await res.json();

      message.textContent = result.success
        ? 'Thank you! Your bid has been submitted.'
        : 'Something went wrong.';
    } catch (error) {
      console.error("Fetch error:", error);
      message.textContent = "An error occurred while submitting your bid.";
    }

    loadHighestBid();
  });

  async function loadHighestBid() {
    const res = await fetch('/api/bids?product=Chronoformosis');
    const { highestBid } = await res.json();

    document.getElementById('highest-bid').textContent = highestBid
      ? `Current Highest Bid: $${highestBid.bidAmount}`
      : 'No bids yet â€” be the first!';
  }

  loadHighestBid();
</script>
